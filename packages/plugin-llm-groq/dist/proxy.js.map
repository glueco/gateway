{"version":3,"sources":["../src/proxy.ts","../src/contracts.ts"],"sourcesContent":["// ============================================\n// GROQ PLUGIN PROXY\n// Server-side plugin implementation for the gateway\n// ============================================\n//\n// This module is imported by the proxy to handle Groq requests.\n// It should NOT be imported by target apps.\n//\n// Import path: @glueco/plugin-llm-groq/proxy\n// ============================================\n\nimport type {\n  PluginContract,\n  PluginResourceConstraints,\n  PluginValidationResult,\n  PluginExecuteContext,\n  PluginExecuteOptions,\n  PluginExecuteResult,\n  PluginUsageMetrics,\n  PluginMappedError,\n  EnforcementFields,\n} from \"@glueco/shared\";\nimport { createPluginBase } from \"@glueco/shared\";\n\nimport {\n  ChatCompletionRequestSchema,\n  type ChatCompletionRequest,\n  PLUGIN_ID,\n  RESOURCE_TYPE,\n  PROVIDER,\n  VERSION,\n  DEFAULT_GROQ_MODELS,\n  ACTIONS,\n  ENFORCEMENT_SUPPORT,\n} from \"./contracts\";\n\n// ============================================\n// CONFIGURATION\n// ============================================\n\nconst GROQ_API_URL = \"https://api.groq.com/openai/v1\";\n\n// ============================================\n// ERROR HANDLING\n// ============================================\n\nclass GroqApiError extends Error {\n  constructor(\n    public status: number,\n    public body: string,\n  ) {\n    super(`Groq API error: ${status}`);\n    this.name = \"GroqApiError\";\n  }\n}\n\nfunction mapGroqError(error: GroqApiError): PluginMappedError {\n  let parsed: { error?: { message?: string; type?: string; code?: string } } =\n    {};\n  try {\n    parsed = JSON.parse(error.body);\n  } catch {\n    // Ignore parse errors\n  }\n\n  const message = parsed.error?.message || error.body;\n\n  switch (error.status) {\n    case 400:\n      return { status: 400, code: \"BAD_REQUEST\", message, retryable: false };\n    case 401:\n      return {\n        status: 401,\n        code: \"UNAUTHORIZED\",\n        message: \"Invalid API key\",\n        retryable: false,\n      };\n    case 403:\n      return { status: 403, code: \"FORBIDDEN\", message, retryable: false };\n    case 404:\n      return { status: 404, code: \"NOT_FOUND\", message, retryable: false };\n    case 429:\n      return { status: 429, code: \"RATE_LIMITED\", message, retryable: true };\n    case 500:\n    case 502:\n    case 503:\n      return {\n        status: error.status,\n        code: \"PROVIDER_ERROR\",\n        message,\n        retryable: true,\n      };\n    default:\n      return {\n        status: error.status,\n        code: \"UNKNOWN\",\n        message,\n        retryable: false,\n      };\n  }\n}\n\n// ============================================\n// PLUGIN IMPLEMENTATION\n// ============================================\n\nconst groqPlugin: PluginContract = {\n  ...createPluginBase({\n    id: PLUGIN_ID,\n    resourceType: RESOURCE_TYPE,\n    provider: PROVIDER,\n    version: VERSION,\n    name: \"Groq LLM\",\n    actions: [...ACTIONS],\n    supports: {\n      enforcement: [...ENFORCEMENT_SUPPORT],\n    },\n    // Client contract metadata for SDK-compatible plugins\n    client: {\n      namespace: \"groq\",\n      actions: {\n        \"chat.completions\": {\n          description:\n            \"Generate chat completions using Groq's fast LLM inference\",\n        },\n      },\n    },\n  }),\n\n  // Credential schema for UI\n  credentialSchema: {\n    fields: [\n      {\n        name: \"apiKey\",\n        type: \"secret\",\n        label: \"API Key\",\n        description: \"Your Groq API key\",\n        required: true,\n      },\n      {\n        name: \"baseUrl\",\n        type: \"url\",\n        label: \"Base URL\",\n        description: \"Custom API base URL (optional)\",\n        required: false,\n        default: GROQ_API_URL,\n      },\n    ],\n  },\n\n  validateAndShape(\n    action: string,\n    input: unknown,\n    constraints: PluginResourceConstraints,\n  ): PluginValidationResult {\n    if (action !== \"chat.completions\") {\n      return { valid: false, error: `Unsupported action: ${action}` };\n    }\n\n    // Parse input - this is the schema-first validation\n    const parsed = ChatCompletionRequestSchema.safeParse(input);\n    if (!parsed.success) {\n      return {\n        valid: false,\n        error: `Invalid request: ${parsed.error.errors.map((e) => e.message).join(\", \")}`,\n      };\n    }\n\n    const request = parsed.data;\n\n    // Build enforcement fields from validated request\n    // These are extracted DURING validation, not after\n    const enforcement: EnforcementFields = {\n      model: request.model,\n      stream: request.stream ?? false,\n      usesTools: Array.isArray(request.tools) && request.tools.length > 0,\n      maxOutputTokens: request.max_tokens ?? request.max_completion_tokens,\n    };\n\n    // Check allowed models\n    const allowedModels = constraints.allowedModels ?? [...DEFAULT_GROQ_MODELS];\n    if (!allowedModels.includes(request.model)) {\n      return {\n        valid: false,\n        error: `Model '${request.model}' not allowed. Allowed: ${allowedModels.join(\", \")}`,\n      };\n    }\n\n    // Enforce max tokens\n    const maxTokens = constraints.maxOutputTokens ?? 4096;\n    const requestedTokens = request.max_tokens ?? request.max_completion_tokens;\n\n    if (requestedTokens && requestedTokens > maxTokens) {\n      return {\n        valid: false,\n        error: `max_tokens (${requestedTokens}) exceeds limit (${maxTokens})`,\n      };\n    }\n\n    // Check streaming permission\n    if (request.stream && constraints.allowStreaming === false) {\n      return {\n        valid: false,\n        error: \"Streaming is not allowed for this app\",\n      };\n    }\n\n    // Shape the request (apply defaults, caps)\n    const shapedRequest: ChatCompletionRequest = {\n      ...request,\n      max_tokens: requestedTokens\n        ? Math.min(requestedTokens, maxTokens)\n        : maxTokens,\n    };\n\n    return { valid: true, shapedInput: shapedRequest, enforcement };\n  },\n\n  async execute(\n    action: string,\n    shapedInput: unknown,\n    ctx: PluginExecuteContext,\n    options: PluginExecuteOptions,\n  ): Promise<PluginExecuteResult> {\n    const request = shapedInput as ChatCompletionRequest;\n    const baseUrl = (ctx.config?.baseUrl as string) || GROQ_API_URL;\n\n    const response = await fetch(`${baseUrl}/chat/completions`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${ctx.secret}`,\n      },\n      body: JSON.stringify(request),\n      signal: options.signal,\n    });\n\n    if (!response.ok) {\n      const errorBody = await response.text();\n      throw new GroqApiError(response.status, errorBody);\n    }\n\n    if (request.stream) {\n      // Return streaming response\n      return {\n        stream: response.body!,\n        contentType: \"text/event-stream\",\n      };\n    } else {\n      // Return JSON response\n      const json = await response.json();\n      return {\n        response: json,\n        contentType: \"application/json\",\n        usage: this.extractUsage(json),\n      };\n    }\n  },\n\n  extractUsage(response: unknown): PluginUsageMetrics {\n    const res = response as {\n      usage?: {\n        prompt_tokens?: number;\n        completion_tokens?: number;\n        total_tokens?: number;\n      };\n      model?: string;\n    };\n\n    return {\n      inputTokens: res.usage?.prompt_tokens,\n      outputTokens: res.usage?.completion_tokens,\n      totalTokens: res.usage?.total_tokens,\n      model: res.model,\n    };\n  },\n\n  mapError(error: unknown): PluginMappedError {\n    if (error instanceof GroqApiError) {\n      return mapGroqError(error);\n    }\n\n    return {\n      status: 500,\n      code: \"INTERNAL_ERROR\",\n      message: error instanceof Error ? error.message : \"Unknown error\",\n      retryable: false,\n    };\n  },\n};\n\nexport default groqPlugin;\n\n// Also export named for flexibility\nexport { groqPlugin };\n","// ============================================\n// GROQ PLUGIN CONTRACTS\n// Shared request/response schemas for proxy and client\n// ============================================\n\nimport { z } from \"zod\";\n\n// ============================================\n// REQUEST SCHEMAS (OpenAI-compatible)\n// ============================================\n\nexport const ChatMessageSchema = z.object({\n  role: z.enum([\"system\", \"user\", \"assistant\", \"tool\"]),\n  content: z\n    .union([\n      z.string(),\n      z.array(\n        z.object({\n          type: z.string(),\n          text: z.string().optional(),\n          image_url: z\n            .object({\n              url: z.string(),\n              detail: z.string().optional(),\n            })\n            .optional(),\n        }),\n      ),\n    ])\n    .nullable(),\n  name: z.string().optional(),\n  tool_calls: z\n    .array(\n      z.object({\n        id: z.string(),\n        type: z.literal(\"function\"),\n        function: z.object({\n          name: z.string(),\n          arguments: z.string(),\n        }),\n      }),\n    )\n    .optional(),\n  tool_call_id: z.string().optional(),\n});\n\nexport type ChatMessage = z.infer<typeof ChatMessageSchema>;\n\nexport const ChatCompletionRequestSchema = z.object({\n  model: z.string(),\n  messages: z.array(ChatMessageSchema),\n  temperature: z.number().min(0).max(2).optional(),\n  top_p: z.number().min(0).max(1).optional(),\n  n: z.number().int().min(1).max(10).optional(),\n  stream: z.boolean().optional(),\n  stop: z.union([z.string(), z.array(z.string())]).optional(),\n  max_tokens: z.number().int().positive().optional(),\n  max_completion_tokens: z.number().int().positive().optional(),\n  presence_penalty: z.number().min(-2).max(2).optional(),\n  frequency_penalty: z.number().min(-2).max(2).optional(),\n  logit_bias: z.record(z.number()).optional(),\n  user: z.string().optional(),\n  tools: z\n    .array(\n      z.object({\n        type: z.literal(\"function\"),\n        function: z.object({\n          name: z.string(),\n          description: z.string().optional(),\n          parameters: z.record(z.unknown()).optional(),\n        }),\n      }),\n    )\n    .optional(),\n  tool_choice: z\n    .union([\n      z.literal(\"none\"),\n      z.literal(\"auto\"),\n      z.literal(\"required\"),\n      z.object({\n        type: z.literal(\"function\"),\n        function: z.object({ name: z.string() }),\n      }),\n    ])\n    .optional(),\n  response_format: z\n    .object({\n      type: z.enum([\"text\", \"json_object\"]),\n    })\n    .optional(),\n  seed: z.number().int().optional(),\n});\n\nexport type ChatCompletionRequest = z.infer<typeof ChatCompletionRequestSchema>;\n\n// ============================================\n// RESPONSE SCHEMAS (OpenAI-compatible)\n// ============================================\n\nexport const ChatCompletionChoiceSchema = z.object({\n  index: z.number(),\n  message: z.object({\n    role: z.literal(\"assistant\"),\n    content: z.string().nullable(),\n    tool_calls: z\n      .array(\n        z.object({\n          id: z.string(),\n          type: z.literal(\"function\"),\n          function: z.object({\n            name: z.string(),\n            arguments: z.string(),\n          }),\n        }),\n      )\n      .optional(),\n  }),\n  finish_reason: z.string().nullable(),\n});\n\nexport type ChatCompletionChoice = z.infer<typeof ChatCompletionChoiceSchema>;\n\nexport const UsageSchema = z.object({\n  prompt_tokens: z.number(),\n  completion_tokens: z.number(),\n  total_tokens: z.number(),\n});\n\nexport type Usage = z.infer<typeof UsageSchema>;\n\nexport const ChatCompletionResponseSchema = z.object({\n  id: z.string(),\n  object: z.literal(\"chat.completion\"),\n  created: z.number(),\n  model: z.string(),\n  choices: z.array(ChatCompletionChoiceSchema),\n  usage: UsageSchema.optional(),\n});\n\nexport type ChatCompletionResponse = z.infer<\n  typeof ChatCompletionResponseSchema\n>;\n\n// ============================================\n// STREAMING RESPONSE SCHEMAS\n// ============================================\n\nexport const ChatCompletionChunkSchema = z.object({\n  id: z.string(),\n  object: z.literal(\"chat.completion.chunk\"),\n  created: z.number(),\n  model: z.string(),\n  choices: z.array(\n    z.object({\n      index: z.number(),\n      delta: z.object({\n        role: z.string().optional(),\n        content: z.string().optional(),\n        tool_calls: z\n          .array(\n            z.object({\n              index: z.number(),\n              id: z.string().optional(),\n              type: z.literal(\"function\").optional(),\n              function: z\n                .object({\n                  name: z.string().optional(),\n                  arguments: z.string().optional(),\n                })\n                .optional(),\n            }),\n          )\n          .optional(),\n      }),\n      finish_reason: z.string().nullable(),\n    }),\n  ),\n});\n\nexport type ChatCompletionChunk = z.infer<typeof ChatCompletionChunkSchema>;\n\n// ============================================\n// PLUGIN CONSTANTS\n// ============================================\n\nexport const PLUGIN_ID = \"llm:groq\" as const;\nexport const RESOURCE_TYPE = \"llm\" as const;\nexport const PROVIDER = \"groq\" as const;\nexport const VERSION = \"1.0.0\";\n\n/** Default allowed models */\nexport const DEFAULT_GROQ_MODELS = [\n  \"llama-3.3-70b-versatile\",\n  \"llama-3.1-70b-versatile\",\n  \"llama-3.1-8b-instant\",\n  \"llama3-70b-8192\",\n  \"llama3-8b-8192\",\n  \"mixtral-8x7b-32768\",\n  \"gemma2-9b-it\",\n] as const;\n\n/** Supported actions */\nexport const ACTIONS = [\"chat.completions\"] as const;\nexport type GroqAction = (typeof ACTIONS)[number];\n\n/** Enforcement knobs */\nexport const ENFORCEMENT_SUPPORT = [\n  \"model\",\n  \"max_tokens\",\n  \"streaming\",\n] as const;\n"],"mappings":"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","names":[]}