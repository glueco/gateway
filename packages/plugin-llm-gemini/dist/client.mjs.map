{"version":3,"sources":["../src/client.ts"],"sourcesContent":["// ============================================\n// GEMINI PLUGIN CLIENT\n// Typed client wrapper for target apps\n// ============================================\n//\n// This module provides typed client wrappers for the Gemini LLM plugin.\n// It depends only on the SDK transport interface and shared contracts.\n//\n// Usage:\n// ```ts\n// import { gemini } from \"@glueco/plugin-llm-gemini/client\";\n// import { GatewayClient } from \"@glueco/sdk\";\n//\n// const client = new GatewayClient({ ... });\n// const transport = await client.getTransport();\n// const geminiClient = gemini(transport);\n//\n// const response = await geminiClient.chatCompletions({\n//   model: \"gemini-1.5-flash\",\n//   messages: [{ role: \"user\", content: \"Hello!\" }]\n// });\n// ```\n// ============================================\n\nimport type {\n  GatewayTransport,\n  GatewayResponse,\n  GatewayStreamResponse,\n  GatewayRequestOptions,\n} from \"@glueco/sdk\";\n\nimport {\n  type ChatCompletionRequest,\n  type ChatCompletionResponse,\n  PLUGIN_ID,\n} from \"./contracts\";\n\n// Re-export contracts for consumer convenience\nexport * from \"./contracts\";\n\n// ============================================\n// CLIENT TYPES\n// ============================================\n\n/**\n * Options for chat completion requests.\n */\nexport interface ChatCompletionOptions\n  extends Omit<GatewayRequestOptions, \"stream\" | \"method\"> {\n  /**\n   * Override for custom behavior (advanced usage).\n   */\n  raw?: boolean;\n}\n\n/**\n * Gemini client interface.\n * Provides typed methods for all supported actions.\n */\nexport interface GeminiClient {\n  /**\n   * Create a chat completion.\n   *\n   * @param request - Chat completion request (OpenAI-compatible format)\n   * @param options - Optional request options\n   * @returns Chat completion response\n   *\n   * @example\n   * ```ts\n   * const response = await geminiClient.chatCompletions({\n   *   model: \"gemini-1.5-flash\",\n   *   messages: [\n   *     { role: \"system\", content: \"You are a helpful assistant.\" },\n   *     { role: \"user\", content: \"What is the capital of France?\" }\n   *   ],\n   *   temperature: 0.7,\n   *   max_tokens: 1000\n   * });\n   *\n   * console.log(response.data.choices[0].message.content);\n   * ```\n   */\n  chatCompletions(\n    request: ChatCompletionRequest,\n    options?: ChatCompletionOptions,\n  ): Promise<GatewayResponse<ChatCompletionResponse>>;\n\n  /**\n   * Create a streaming chat completion.\n   *\n   * @param request - Chat completion request (stream flag will be set automatically)\n   * @param options - Optional request options\n   * @returns Streaming response with SSE stream\n   *\n   * @example\n   * ```ts\n   * const response = await geminiClient.chatCompletionsStream({\n   *   model: \"gemini-1.5-flash\",\n   *   messages: [{ role: \"user\", content: \"Tell me a story\" }]\n   * });\n   *\n   * const reader = response.stream.getReader();\n   * const decoder = new TextDecoder();\n   *\n   * while (true) {\n   *   const { done, value } = await reader.read();\n   *   if (done) break;\n   *   const chunk = decoder.decode(value);\n   *   // Process SSE chunk\n   * }\n   * ```\n   */\n  chatCompletionsStream(\n    request: Omit<ChatCompletionRequest, \"stream\">,\n    options?: ChatCompletionOptions,\n  ): Promise<GatewayStreamResponse>;\n\n  /**\n   * Get the underlying transport for advanced usage.\n   * Useful when you need direct access to the gateway.\n   */\n  readonly transport: GatewayTransport;\n}\n\n// ============================================\n// CLIENT FACTORY\n// ============================================\n\n/**\n * Create a typed Gemini client.\n *\n * @param transport - Gateway transport from SDK\n * @returns Typed Gemini client\n *\n * @example\n * ```ts\n * import { gemini } from \"@glueco/plugin-llm-gemini/client\";\n * import { GatewayClient } from \"@glueco/sdk\";\n *\n * // Setup\n * const gatewayClient = new GatewayClient({\n *   keyStorage: new FileKeyStorage('./.gateway/keys.json'),\n *   configStorage: new FileConfigStorage('./.gateway/config.json'),\n * });\n *\n * // Get transport and create typed client\n * const transport = await gatewayClient.getTransport();\n * const geminiClient = gemini(transport);\n *\n * // Use with full type safety\n * const response = await geminiClient.chatCompletions({\n *   model: \"gemini-1.5-flash\",\n *   messages: [{ role: \"user\", content: \"Hello!\" }]\n * });\n * ```\n */\nexport function gemini(transport: GatewayTransport): GeminiClient {\n  return {\n    transport,\n\n    async chatCompletions(\n      request: ChatCompletionRequest,\n      options?: ChatCompletionOptions,\n    ): Promise<GatewayResponse<ChatCompletionResponse>> {\n      // Ensure stream is false for non-streaming requests\n      const payload = { ...request, stream: false };\n\n      return transport.request<ChatCompletionResponse, ChatCompletionRequest>(\n        PLUGIN_ID,\n        \"chat.completions\",\n        payload,\n        options,\n      );\n    },\n\n    async chatCompletionsStream(\n      request: Omit<ChatCompletionRequest, \"stream\">,\n      options?: ChatCompletionOptions,\n    ): Promise<GatewayStreamResponse> {\n      return transport.requestStream(PLUGIN_ID, \"chat.completions\", request, options);\n    },\n  };\n}\n\n// Default export for convenient importing\nexport default gemini;\n"],"mappings":";;;;;;;;;;;;;;;;;AA4JO,SAAS,OAAO,WAA2C;AAChE,SAAO;AAAA,IACL;AAAA,IAEA,MAAM,gBACJ,SACA,SACkD;AAElD,YAAM,UAAU,EAAE,GAAG,SAAS,QAAQ,MAAM;AAE5C,aAAO,UAAU;AAAA,QACf;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,IAEA,MAAM,sBACJ,SACA,SACgC;AAChC,aAAO,UAAU,cAAc,WAAW,oBAAoB,SAAS,OAAO;AAAA,IAChF;AAAA,EACF;AACF;AAGA,IAAO,iBAAQ;","names":[]}