{"version":3,"sources":["../src/errors.ts","../src/schemas.ts","../src/access-policy.ts","../src/index.ts"],"names":["ErrorCode"],"mappings":"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","file":"index.mjs","sourcesContent":["// ============================================\n// ERROR CODES\n// Standardized error codes for the gateway\n// ============================================\n\n/**\n * Gateway error codes.\n */\nexport enum ErrorCode {\n  // Resource errors\n  ERR_RESOURCE_REQUIRED = \"ERR_RESOURCE_REQUIRED\",\n  ERR_UNKNOWN_RESOURCE = \"ERR_UNKNOWN_RESOURCE\",\n  ERR_RESOURCE_NOT_CONFIGURED = \"ERR_RESOURCE_NOT_CONFIGURED\",\n  ERR_UNSUPPORTED_ACTION = \"ERR_UNSUPPORTED_ACTION\",\n\n  // Auth errors\n  ERR_MISSING_AUTH = \"ERR_MISSING_AUTH\",\n  ERR_INVALID_SIGNATURE = \"ERR_INVALID_SIGNATURE\",\n  ERR_EXPIRED_TIMESTAMP = \"ERR_EXPIRED_TIMESTAMP\",\n  ERR_INVALID_NONCE = \"ERR_INVALID_NONCE\",\n  ERR_APP_NOT_FOUND = \"ERR_APP_NOT_FOUND\",\n  ERR_APP_DISABLED = \"ERR_APP_DISABLED\",\n\n  // Permission errors\n  ERR_PERMISSION_DENIED = \"ERR_PERMISSION_DENIED\",\n  ERR_CONSTRAINT_VIOLATION = \"ERR_CONSTRAINT_VIOLATION\",\n\n  // Rate/budget errors\n  ERR_RATE_LIMIT_EXCEEDED = \"ERR_RATE_LIMIT_EXCEEDED\",\n  ERR_BUDGET_EXCEEDED = \"ERR_BUDGET_EXCEEDED\",\n\n  // Request errors\n  ERR_INVALID_REQUEST = \"ERR_INVALID_REQUEST\",\n  ERR_INVALID_JSON = \"ERR_INVALID_JSON\",\n\n  // Internal errors\n  ERR_INTERNAL = \"ERR_INTERNAL\",\n  ERR_UPSTREAM_ERROR = \"ERR_UPSTREAM_ERROR\",\n\n  // Pairing errors\n  ERR_INVALID_PAIRING_STRING = \"ERR_INVALID_PAIRING_STRING\",\n  ERR_INVALID_CONNECT_CODE = \"ERR_INVALID_CONNECT_CODE\",\n  ERR_SESSION_EXPIRED = \"ERR_SESSION_EXPIRED\",\n}\n\n/**\n * Get HTTP status code for an error code.\n */\nexport function getErrorStatus(code: ErrorCode): number {\n  switch (code) {\n    case ErrorCode.ERR_RESOURCE_REQUIRED:\n    case ErrorCode.ERR_INVALID_REQUEST:\n    case ErrorCode.ERR_INVALID_JSON:\n    case ErrorCode.ERR_CONSTRAINT_VIOLATION:\n    case ErrorCode.ERR_INVALID_PAIRING_STRING:\n    case ErrorCode.ERR_INVALID_CONNECT_CODE:\n      return 400;\n\n    case ErrorCode.ERR_MISSING_AUTH:\n    case ErrorCode.ERR_INVALID_SIGNATURE:\n    case ErrorCode.ERR_EXPIRED_TIMESTAMP:\n    case ErrorCode.ERR_INVALID_NONCE:\n      return 401;\n\n    case ErrorCode.ERR_PERMISSION_DENIED:\n    case ErrorCode.ERR_APP_DISABLED:\n      return 403;\n\n    case ErrorCode.ERR_APP_NOT_FOUND:\n    case ErrorCode.ERR_UNKNOWN_RESOURCE:\n    case ErrorCode.ERR_UNSUPPORTED_ACTION:\n      return 404;\n\n    case ErrorCode.ERR_SESSION_EXPIRED:\n      return 410;\n\n    case ErrorCode.ERR_RATE_LIMIT_EXCEEDED:\n    case ErrorCode.ERR_BUDGET_EXCEEDED:\n      return 429;\n\n    case ErrorCode.ERR_RESOURCE_NOT_CONFIGURED:\n    case ErrorCode.ERR_INTERNAL:\n    case ErrorCode.ERR_UPSTREAM_ERROR:\n      return 500;\n\n    default:\n      return 500;\n  }\n}\n\n/**\n * Gateway error class.\n */\nexport class GatewayError extends Error {\n  public readonly code: ErrorCode;\n  public readonly status: number;\n  public readonly details?: Record<string, unknown>;\n\n  constructor(\n    code: ErrorCode,\n    message: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message);\n    this.name = \"GatewayError\";\n    this.code = code;\n    this.status = getErrorStatus(code);\n    this.details = details;\n  }\n\n  toJSON() {\n    return {\n      error: {\n        code: this.code,\n        message: this.message,\n        ...(this.details && { details: this.details }),\n      },\n    };\n  }\n}\n\n/**\n * Create a resource required error with helpful message.\n */\nexport function resourceRequiredError(hint?: string): GatewayError {\n  const message = hint\n    ? `Resource not specified. ${hint}`\n    : \"Resource not specified. Set baseURL to /r/<resourceType>/<provider>/v1 or provide x-gateway-resource header.\";\n\n  return new GatewayError(ErrorCode.ERR_RESOURCE_REQUIRED, message, {\n    examples: {\n      groq: \"/r/llm/groq/v1/chat/completions\",\n      gemini: \"/r/llm/gemini/v1/chat/completions\",\n      header: \"x-gateway-resource: llm:groq\",\n    },\n  });\n}\n","import { z } from \"zod\";\n\n// ============================================\n// SHARED SCHEMAS\n// Validation schemas used by proxy and SDK\n// ============================================\n\n/**\n * Chat message schema (OpenAI-compatible).\n */\nexport const ChatMessageSchema = z.object({\n  role: z.enum([\"system\", \"user\", \"assistant\", \"tool\"]),\n  content: z\n    .union([\n      z.string(),\n      z.array(\n        z.object({\n          type: z.string(),\n          text: z.string().optional(),\n          image_url: z\n            .object({\n              url: z.string(),\n              detail: z.string().optional(),\n            })\n            .optional(),\n        }),\n      ),\n    ])\n    .nullable(),\n  name: z.string().optional(),\n  tool_calls: z\n    .array(\n      z.object({\n        id: z.string(),\n        type: z.literal(\"function\"),\n        function: z.object({\n          name: z.string(),\n          arguments: z.string(),\n        }),\n      }),\n    )\n    .optional(),\n  tool_call_id: z.string().optional(),\n});\n\n/**\n * Chat completion request schema (OpenAI-compatible).\n */\nexport const ChatCompletionRequestSchema = z.object({\n  model: z.string(),\n  messages: z.array(ChatMessageSchema),\n  temperature: z.number().min(0).max(2).optional(),\n  top_p: z.number().min(0).max(1).optional(),\n  n: z.number().int().min(1).max(10).optional(),\n  stream: z.boolean().optional(),\n  stop: z.union([z.string(), z.array(z.string())]).optional(),\n  max_tokens: z.number().int().positive().optional(),\n  max_completion_tokens: z.number().int().positive().optional(),\n  presence_penalty: z.number().min(-2).max(2).optional(),\n  frequency_penalty: z.number().min(-2).max(2).optional(),\n  logit_bias: z.record(z.number()).optional(),\n  user: z.string().optional(),\n  tools: z\n    .array(\n      z.object({\n        type: z.literal(\"function\"),\n        function: z.object({\n          name: z.string(),\n          description: z.string().optional(),\n          parameters: z.record(z.unknown()).optional(),\n        }),\n      }),\n    )\n    .optional(),\n  tool_choice: z\n    .union([\n      z.literal(\"none\"),\n      z.literal(\"auto\"),\n      z.literal(\"required\"),\n      z.object({\n        type: z.literal(\"function\"),\n        function: z.object({ name: z.string() }),\n      }),\n    ])\n    .optional(),\n  response_format: z\n    .object({\n      type: z.enum([\"text\", \"json_object\"]),\n    })\n    .optional(),\n  seed: z.number().int().optional(),\n});\n\nexport type ChatCompletionRequest = z.infer<typeof ChatCompletionRequestSchema>;\nexport type ChatMessage = z.infer<typeof ChatMessageSchema>;\n\n/**\n * Permission request schema.\n */\nexport const PermissionRequestSchema = z.object({\n  resourceId: z.string().regex(/^[a-z]+:[a-z0-9-]+$/, {\n    message: \"Invalid resource ID format. Expected: <resourceType>:<provider>\",\n  }),\n  actions: z.array(z.string()).min(1),\n  constraints: z.record(z.unknown()).optional(),\n});\n\n/**\n * App metadata schema.\n */\nexport const AppMetadataSchema = z.object({\n  name: z.string().min(1).max(100),\n  description: z.string().max(500).optional(),\n  homepage: z.string().url().optional(),\n});\n\n/**\n * Install request schema (for prepare endpoint).\n */\nexport const InstallRequestSchema = z.object({\n  connectCode: z.string().min(16),\n  app: AppMetadataSchema,\n  publicKey: z.string().min(40),\n  requestedPermissions: z.array(PermissionRequestSchema).min(1),\n  redirectUri: z.string().url(),\n});\n\nexport type InstallRequest = z.infer<typeof InstallRequestSchema>;\n","// ============================================\n// ACCESS POLICY TYPES\n// Comprehensive access control configuration\n// ============================================\n\n/**\n * Time window restriction.\n * Allows access only during specific hours of the day.\n */\nexport interface TimeWindow {\n  /** Start hour (0-23) in the specified timezone */\n  startHour: number;\n  /** End hour (0-23) in the specified timezone */\n  endHour: number;\n  /** Timezone for the time window (e.g., \"UTC\", \"America/New_York\") */\n  timezone: string;\n  /** Days of week allowed (0=Sunday, 6=Saturday). Empty = all days */\n  allowedDays?: number[];\n}\n\n/**\n * Rate limit configuration.\n */\nexport interface RateLimitConfig {\n  /** Maximum requests allowed in the window */\n  maxRequests: number;\n  /** Window duration in seconds */\n  windowSeconds: number;\n}\n\n/**\n * Burst limit configuration.\n * Allows short-term spikes above the sustained rate limit.\n */\nexport interface BurstConfig {\n  /** Maximum requests allowed in burst window */\n  limit: number;\n  /** Burst window duration in seconds (typically short, e.g., 10s) */\n  windowSeconds: number;\n}\n\n/**\n * Quota configuration for daily/monthly limits.\n */\nexport interface QuotaConfig {\n  /** Daily request quota (null = unlimited) */\n  daily?: number;\n  /** Monthly request quota (null = unlimited) */\n  monthly?: number;\n}\n\n/**\n * Token budget for LLM resources.\n */\nexport interface TokenBudget {\n  /** Daily token budget (null = unlimited) */\n  daily?: number;\n  /** Monthly token budget (null = unlimited) */\n  monthly?: number;\n}\n\n/**\n * LLM-specific constraints.\n */\nexport interface LLMConstraints {\n  /** Allowed model IDs (empty = all models allowed) */\n  allowedModels?: string[];\n  /** Maximum output tokens per request */\n  maxOutputTokens?: number;\n  /** Maximum input tokens per request */\n  maxInputTokens?: number;\n  /** Allow streaming responses */\n  allowStreaming?: boolean;\n  /** Maximum context window */\n  maxContextWindow?: number;\n}\n\n/**\n * Email-specific constraints.\n */\nexport interface EmailConstraints {\n  /** Allowed from domains */\n  allowedFromDomains?: string[];\n  /** Maximum recipients per email */\n  maxRecipients?: number;\n  /** Allow HTML content */\n  allowHtml?: boolean;\n  /** Maximum attachment size in bytes */\n  maxAttachmentSize?: number;\n}\n\n/**\n * Generic HTTP constraints.\n */\nexport interface HTTPConstraints {\n  /** Maximum request body size in bytes */\n  maxRequestBodySize?: number;\n  /** Allowed HTTP methods */\n  allowedMethods?: string[];\n  /** Custom constraints */\n  custom?: Record<string, unknown>;\n}\n\n/**\n * Union type for all constraint types.\n */\nexport type ResourceConstraints =\n  | LLMConstraints\n  | EmailConstraints\n  | HTTPConstraints\n  | Record<string, unknown>;\n\n/**\n * Complete access policy for a permission.\n * This is what the proxy owner configures during approval.\n */\nexport interface AccessPolicy {\n  // ============================================\n  // Time Controls\n  // ============================================\n\n  /** When the permission becomes valid (ISO string, null = immediately) */\n  validFrom?: string | null;\n\n  /** When the permission expires (ISO string, null = never) */\n  expiresAt?: string | null;\n\n  /** Time-of-day restrictions */\n  timeWindow?: TimeWindow | null;\n\n  // ============================================\n  // Rate Limiting\n  // ============================================\n\n  /** Sustained rate limit */\n  rateLimit?: RateLimitConfig;\n\n  /** Burst allowance */\n  burst?: BurstConfig;\n\n  // ============================================\n  // Quotas\n  // ============================================\n\n  /** Request quotas */\n  quota?: QuotaConfig;\n\n  /** Token budget (LLM resources) */\n  tokenBudget?: TokenBudget;\n\n  // ============================================\n  // Scope Constraints\n  // ============================================\n\n  /** Resource-specific constraints */\n  constraints?: ResourceConstraints;\n}\n\n// ============================================\n// EXPIRY PRESETS\n// Quick options for common expiry scenarios\n// ============================================\n\nexport type ExpiryPreset =\n  | \"1_hour\"\n  | \"4_hours\"\n  | \"today\"\n  | \"24_hours\"\n  | \"this_week\"\n  | \"1_month\"\n  | \"3_months\"\n  | \"1_year\"\n  | \"never\"\n  | \"custom\";\n\nexport interface ExpiryPresetOption {\n  value: ExpiryPreset;\n  label: string;\n  description: string;\n  getDate: () => Date | null;\n}\n\n/**\n * Get expiry date from preset.\n */\nexport function getExpiryFromPreset(preset: ExpiryPreset): Date | null {\n  const now = new Date();\n\n  switch (preset) {\n    case \"1_hour\":\n      return new Date(now.getTime() + 60 * 60 * 1000);\n    case \"4_hours\":\n      return new Date(now.getTime() + 4 * 60 * 60 * 1000);\n    case \"today\":\n      // End of today in local timezone\n      const endOfDay = new Date(now);\n      endOfDay.setHours(23, 59, 59, 999);\n      return endOfDay;\n    case \"24_hours\":\n      return new Date(now.getTime() + 24 * 60 * 60 * 1000);\n    case \"this_week\":\n      // End of this week (Sunday)\n      const endOfWeek = new Date(now);\n      const daysUntilSunday = 7 - endOfWeek.getDay();\n      endOfWeek.setDate(endOfWeek.getDate() + daysUntilSunday);\n      endOfWeek.setHours(23, 59, 59, 999);\n      return endOfWeek;\n    case \"1_month\":\n      return new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n    case \"3_months\":\n      return new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);\n    case \"1_year\":\n      return new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000);\n    case \"never\":\n      return null;\n    case \"custom\":\n      return null; // Custom requires manual date input\n    default:\n      return null;\n  }\n}\n\n/**\n * All available expiry presets with labels.\n */\nexport const EXPIRY_PRESETS: ExpiryPresetOption[] = [\n  {\n    value: \"1_hour\",\n    label: \"1 hour\",\n    description: \"Expires in 1 hour\",\n    getDate: () => getExpiryFromPreset(\"1_hour\"),\n  },\n  {\n    value: \"4_hours\",\n    label: \"4 hours\",\n    description: \"Expires in 4 hours\",\n    getDate: () => getExpiryFromPreset(\"4_hours\"),\n  },\n  {\n    value: \"today\",\n    label: \"End of today\",\n    description: \"Expires at midnight\",\n    getDate: () => getExpiryFromPreset(\"today\"),\n  },\n  {\n    value: \"24_hours\",\n    label: \"24 hours\",\n    description: \"Expires in 24 hours\",\n    getDate: () => getExpiryFromPreset(\"24_hours\"),\n  },\n  {\n    value: \"this_week\",\n    label: \"This week\",\n    description: \"Expires end of week\",\n    getDate: () => getExpiryFromPreset(\"this_week\"),\n  },\n  {\n    value: \"1_month\",\n    label: \"1 month\",\n    description: \"Expires in 30 days\",\n    getDate: () => getExpiryFromPreset(\"1_month\"),\n  },\n  {\n    value: \"3_months\",\n    label: \"3 months\",\n    description: \"Expires in 90 days\",\n    getDate: () => getExpiryFromPreset(\"3_months\"),\n  },\n  {\n    value: \"1_year\",\n    label: \"1 year\",\n    description: \"Expires in 1 year\",\n    getDate: () => getExpiryFromPreset(\"1_year\"),\n  },\n  {\n    value: \"never\",\n    label: \"Never\",\n    description: \"No expiration\",\n    getDate: () => null,\n  },\n  {\n    value: \"custom\",\n    label: \"Custom\",\n    description: \"Set custom date\",\n    getDate: () => null,\n  },\n];\n\n// ============================================\n// RATE LIMIT PRESETS\n// ============================================\n\nexport interface RateLimitPreset {\n  label: string;\n  value: RateLimitConfig;\n}\n\nexport const RATE_LIMIT_PRESETS: RateLimitPreset[] = [\n  {\n    label: \"5 per minute (very restricted)\",\n    value: { maxRequests: 5, windowSeconds: 60 },\n  },\n  { label: \"10 per minute\", value: { maxRequests: 10, windowSeconds: 60 } },\n  { label: \"30 per minute\", value: { maxRequests: 30, windowSeconds: 60 } },\n  {\n    label: \"60 per minute (standard)\",\n    value: { maxRequests: 60, windowSeconds: 60 },\n  },\n  { label: \"100 per hour\", value: { maxRequests: 100, windowSeconds: 3600 } },\n  { label: \"500 per hour\", value: { maxRequests: 500, windowSeconds: 3600 } },\n  { label: \"1000 per day\", value: { maxRequests: 1000, windowSeconds: 86400 } },\n];\n\n// ============================================\n// VALIDATION HELPERS\n// ============================================\n\n/**\n * Check if a permission is currently valid based on time controls.\n */\nexport function isPermissionValidNow(policy: AccessPolicy): {\n  valid: boolean;\n  reason?: string;\n} {\n  const now = new Date();\n\n  // Check validFrom\n  if (policy.validFrom) {\n    const validFromDate = new Date(policy.validFrom);\n    if (now < validFromDate) {\n      return {\n        valid: false,\n        reason: `Permission not yet valid. Starts at ${validFromDate.toISOString()}`,\n      };\n    }\n  }\n\n  // Check expiresAt\n  if (policy.expiresAt) {\n    const expiresAtDate = new Date(policy.expiresAt);\n    if (now > expiresAtDate) {\n      return {\n        valid: false,\n        reason: `Permission expired at ${expiresAtDate.toISOString()}`,\n      };\n    }\n  }\n\n  // Check time window\n  if (policy.timeWindow) {\n    const { startHour, endHour, timezone, allowedDays } = policy.timeWindow;\n\n    // Get current time in the specified timezone\n    const formatter = new Intl.DateTimeFormat(\"en-US\", {\n      hour: \"numeric\",\n      hour12: false,\n      timeZone: timezone,\n    });\n    const currentHour = parseInt(formatter.format(now), 10);\n\n    // Get current day (0 = Sunday)\n    const dayFormatter = new Intl.DateTimeFormat(\"en-US\", {\n      weekday: \"short\",\n      timeZone: timezone,\n    });\n    const dayNames = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n    const currentDayName = dayFormatter.format(now);\n    const currentDay = dayNames.indexOf(currentDayName.slice(0, 3));\n\n    // Check allowed days\n    if (\n      allowedDays &&\n      allowedDays.length > 0 &&\n      !allowedDays.includes(currentDay)\n    ) {\n      return {\n        valid: false,\n        reason: `Access not allowed on this day (${currentDayName})`,\n      };\n    }\n\n    // Check time window (handles overnight windows like 22:00-06:00)\n    let inWindow: boolean;\n    if (startHour <= endHour) {\n      // Normal window (e.g., 9:00-17:00)\n      inWindow = currentHour >= startHour && currentHour < endHour;\n    } else {\n      // Overnight window (e.g., 22:00-06:00)\n      inWindow = currentHour >= startHour || currentHour < endHour;\n    }\n\n    if (!inWindow) {\n      return {\n        valid: false,\n        reason: `Access only allowed between ${startHour}:00-${endHour}:00 ${timezone}`,\n      };\n    }\n  }\n\n  return { valid: true };\n}\n\n/**\n * Format an access policy for display.\n */\nexport function formatAccessPolicySummary(policy: AccessPolicy): string[] {\n  const summary: string[] = [];\n\n  if (policy.expiresAt) {\n    const date = new Date(policy.expiresAt);\n    summary.push(\n      `Expires: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`,\n    );\n  }\n\n  if (policy.validFrom) {\n    const date = new Date(policy.validFrom);\n    summary.push(\n      `Starts: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`,\n    );\n  }\n\n  if (policy.timeWindow) {\n    const { startHour, endHour, timezone } = policy.timeWindow;\n    summary.push(`Hours: ${startHour}:00-${endHour}:00 ${timezone}`);\n  }\n\n  if (policy.rateLimit) {\n    const { maxRequests, windowSeconds } = policy.rateLimit;\n    if (windowSeconds === 60) summary.push(`Rate: ${maxRequests}/min`);\n    else if (windowSeconds === 3600) summary.push(`Rate: ${maxRequests}/hour`);\n    else if (windowSeconds === 86400) summary.push(`Rate: ${maxRequests}/day`);\n    else summary.push(`Rate: ${maxRequests}/${windowSeconds}s`);\n  }\n\n  if (policy.quota?.daily) {\n    summary.push(`Daily quota: ${policy.quota.daily}`);\n  }\n\n  if (policy.quota?.monthly) {\n    summary.push(`Monthly quota: ${policy.quota.monthly}`);\n  }\n\n  if (policy.tokenBudget?.daily) {\n    summary.push(`Daily tokens: ${policy.tokenBudget.daily.toLocaleString()}`);\n  }\n\n  return summary;\n}\n","// ============================================\n// SHARED TYPES\n// Common types used by proxy and SDK\n// ============================================\n\n/**\n * Resource identifier format: <resourceType>:<provider>\n * Examples: llm:groq, llm:gemini, mail:resend\n */\nexport type ResourceId = `${string}:${string}`;\n\n/**\n * Parse a resource ID into its components.\n */\nexport function parseResourceId(resourceId: string): {\n  resourceType: string;\n  provider: string;\n} {\n  const parts = resourceId.split(\":\");\n  if (parts.length !== 2) {\n    throw new Error(\n      `Invalid resource ID format: ${resourceId}. Expected: <resourceType>:<provider>`,\n    );\n  }\n  return {\n    resourceType: parts[0],\n    provider: parts[1],\n  };\n}\n\n/**\n * Create a resource ID from components.\n */\nexport function createResourceId(\n  resourceType: string,\n  provider: string,\n): ResourceId {\n  return `${resourceType}:${provider}` as ResourceId;\n}\n\n/**\n * Pairing string info parsed from pair::<url>::<code>\n */\nexport interface PairingInfo {\n  proxyUrl: string;\n  connectCode: string;\n}\n\n/**\n * Rate limit configuration.\n */\nexport interface RateLimitConfig {\n  maxRequests: number;\n  windowSeconds: number;\n}\n\n/**\n * Permission request for an app.\n */\nexport interface PermissionRequest {\n  resourceId: string;\n  actions: string[];\n  constraints?: Record<string, unknown>;\n  rateLimit?: RateLimitConfig; // Per-permission rate limit\n}\n\n/**\n * App metadata for registration.\n */\nexport interface AppMetadata {\n  name: string;\n  description?: string;\n  homepage?: string;\n}\n\n/**\n * Gateway config stored after approval.\n */\nexport interface GatewayConfig {\n  appId: string;\n  proxyUrl: string;\n}\n\n/**\n * Resource constraint types (generic).\n */\nexport interface ResourceConstraints {\n  // LLM constraints\n  allowedModels?: string[];\n  maxOutputTokens?: number;\n  maxInputTokens?: number;\n  allowStreaming?: boolean;\n\n  // Email constraints\n  allowedFromDomains?: string[];\n  maxRecipients?: number;\n  allowHtml?: boolean;\n\n  // Generic\n  maxRequestBodySize?: number;\n  custom?: Record<string, unknown>;\n}\n\nexport * from \"./errors\";\nexport * from \"./schemas\";\nexport * from \"./access-policy\";\n"]}